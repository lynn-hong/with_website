{% extends "website/base.html" %}
{% load staticfiles %}


{% block page_content %}
    <script>
        window.mobilecheck = function() {
          var check = false;
          (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
          return check;
        };
        $(document).ready(function() {
            $('#calendar').fullCalendar({
                schedulerLicenseKey: 'CC-Attribution-NonCommercial-NoDerivatives',
                defaultView: window.mobilecheck() ? "listWeek" : "month",
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,listWeek'
                  },
                defaultDate: new Date(),
                minTime: "08:00:00",
                maxTime: "24:00:00",
                editable: false,
                selectable: true,
                disableResizing: false,
                contentHeight: 'auto',
                eventColor: '#FFFFBB',
                eventTextColor: 'black',
                eventBorderColor: 'black',
                eventLimit: true, // allow "more" link when too many events
                events: [
                    {% for e in events %}
                        {
                            title: "{{ e.title}}",
                            start: '{{ e.start }}',
                            end: '{{ e.end }}',
                            location: '{{ e.location }}',
                            description: "{% autoescape off %}{{ e.desc|escapejs }}{% endautoescape %}",
                            applications: {{ e.applications|safe }}
                        },
                    {% endfor %}
                    {% for d in special_days %}
                        {
                            title: "{{ d.title }}",
                            start: '{{ d.start }}',
                            description: "{% autoescape off %}{{ d.desc|escapejs }}{% endautoescape %}",
                            color: '{{ d.color }}'
                        },
                    {% endfor %}
                ],
                eventRender: function(event, element) {
                    element.click(function() {
                        if (event.title.indexOf("[생일]") === 0 || event.title.indexOf("[축일]") === 0) {
                            element.attr('data-toggle', "modal");
                            element.attr('data-target', "#special_day");
                            element.attr('href', "#");
                            $("#special_day_title").html(event.title);
                            $("#special_day_desc").html(event.description);
                        } else {
                            element.attr('data-toggle', "modal");
                            element.attr('data-target', "#event");
                            element.attr('href', "#");
                            $("#event_title").html(event.title);
                            $("#event_location").html(event.location);
                            $("#event_desc").html(event.description);
                            $("#event_yes").empty();
                            $("#event_dont_know").empty();
                            $("#event_no").empty();
                            $("#event_early_leave").empty();
                            $("#event_late").empty();
                            var event_yes_cnt = 0;
                            var event_dont_know_cnt = 0;
                            var event_early_leave_cnt = 0;
                            var event_late_cnt = 0;
                            $(event.applications).each(function (index, item) {
                                if (item.status === "참석") {
                                    $("#event_yes").append( "<li class='lmargin20'>" + item.name + "</li>" );
                                    event_yes_cnt += 1;
                                } else if (item.status === "미정") {
                                    $("#event_dont_know").append( "<li class='lmargin20'>" + item.name + "</li>" );
                                    event_dont_know_cnt += 1;
                                } else if (item.status === "일찍가야함") {
                                    $("#event_early_leave").append( "<li class='lmargin20'>" + item.name + "</li>" );
                                    event_early_leave_cnt += 1;
                                } else if (item.status === "늦참") {
                                    $("#event_late").append( "<li class='lmargin20'>" + item.name + "</li>" );
                                    event_late_cnt += 1;
                                }
                            });
                            $("#start_time").html(moment(event.start).format('YYYY-MM-DD h:mm A'));
                            $("#end_time").html(moment(event.end).format('YYYY-MM-DD h:mm A'));
                            $("#event_yes_cnt").html(event_yes_cnt + '명');
                            $("#event_dont_know_cnt").html(event_dont_know_cnt + '명');
                            $("#event_early_leave_cnt").html(event_early_leave_cnt + '명');
                            $("#event_late_cnt").html(event_late_cnt + '명');
                        }
                    })
                }
            });
        });

        // 봉사 신청 submit
        applySubmit = function(){
            var data = $('#apply_form').serializeArray();
            $.ajax({
                type: "POST",
                url: {% url 'apply' %},
                data: data,
                beforeSend: function(){
                    $('#modal_footer').html("<img src={% static 'preloader/loader_icon.gif' %} /> 신청이 진행중입니다!");
                },
                success: function(response){ location.replace( {% url 'thankyou' %} )},
            });
        }

        $("body").on("submit", "form", function() {
            $(this).submit(function() {
                return false;
            });
            return true;
        });

    </script>


    <!-- Inspiro Slider -->
    <div id="slider"
         class="inspiro-slider slider-fullscreen arrows-large arrows-creative dots-creative"
         data-height-xs="360" style="top: -80px; bottom: -80px;">
        <!-- Slide 1 -->
        <div class="slide background-overlay-dark kenburns" data-parallax-image="static/images/with/home_landing.jpg"
        style="opacity: 0.6">
            <div class="container">
                <div class="slide-captions text-light">
                    <!-- Captions -->
                    <span data-animate="fadeInUp" data-animate-delay="300"
                          class="strong" style="padding-top:16%;">
                        <a href="#" class="business">
                            <span class="business">Join us</span>
                        </a>
                    </span>
                    <h1 data-animate="fadeInUp" data-animate-delay="600">
                        서교동성당 청년봉사단체<br>W.I.T.H</h1>
                    <div data-animate="fadeInUp" data-animate-delay="900">
                        <button type="button" class="btn btn-rounded btn-reveal btn-reveal-left"><span>Learn More</span><i class="fa fa-arrow-right"></i></button>
                    </div>
                    <!-- end: Captions -->
                    <div class="row" style="padding-top:14%;">
                        <div class="col-lg-3" data-animate="fadeInUp" data-animate-delay="1200">
                            <h4>진심을 담은 봉사</h4>
                            <p>지상에서 함께 살아가는 많은 이들과 고통을 함께 나누며 진심으로 낮은 자리에서 봉사를 실천합니다</p>
                        </div>
                        <div class="col-lg-3" data-animate="fadeInUp" data-animate-delay="1500">
                            <h4>주님 사랑의 매개체</h4>
                            <p>지역 공동체에 하느님의 사랑을 전파하는 매개체가 되고자 합니다</p>
                        </div>
                        <div class="col-lg-3" data-animate="fadeInUp" data-animate-delay="1800">
                            <h4>즐거운 청년 공간</h4>
                            <p>봉사할 때는 봉사하고 놀 때는 놀 줄 아는 시끌벅적한 청년들이 모인 곳입니다</p>
                        </div>
                        <div class="col-lg-3" data-animate="fadeInUp" data-animate-delay="2100">
                            <h4>여러분과 함께하는 W.I.T.H</h4>
                            <p>따뜻한 마음을 가진 누구에게나 열려 있습니다. 궁금한 점은 언제든지 문의 주세요!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end: Slide 1 -->
    </div>
    <!--end: Inspiro Slider -->

    <!-- 봉사신청 -->
    <section class="p-t-100 p-b-120" id="apply_volun">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 center">
                    <div class="heading-text heading-section text-center" data-animate="fadeInUp">
                        <h4>봉사신청</h4>
                        <h2>나는 네가 한 일을, <br/>너의 사랑과 믿음과 봉사와 인내를 안다.</h2>
                        <p class="lead">현재 온라인으로는 새벽봉사만 신청 받습니다. 은봉&나봉은 대표봉사자에게 별도 문의 부탁드립니다!</p>
                        <p class="lead">처음 오시는 게스트 분들도 신청 가능합니다!</p>
                        <a class="btn btn-default btn-lg" data-target="#modal-3" data-toggle="modal" href="#">봉사 신청</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- end: 봉사신청 -->


    <!-- 봉사신청 modal -->
    <div class="modal fade" id="modal-3" tabindex="-1" role="modal" aria-labelledby="modal-label-3"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-label-3" class="modal-title">위드 봉사신청</h3>
                    <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                </div>
                <div class="modal-body">
                    <div class="row mb20">
                        <div class="col-md-12">
                            <p>* 신청이 완료된 사람은 목록에 이름이 뜨지 않습니다.</p>
                            <p>* 오늘 날짜 이후의 봉사 일정만 신청 가능합니다.</p>
                            <p>* 각 봉사처 설명과 가이드라인 다운로드로 가시려면 x를 누르고 바로 아래로 내려가주세요.</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 xs-box">
                            <h4>위드 단원 or 게스트 선택</h4>
                            <form name="apply_form" id="apply_form">
                                <select id="category_dropdown" name="cat_id">
                                    <option selected value="with">위드 단원</option>
                                    <option value="guest">게스트</option>
                                </select>
                            <h4 class="tmargin25">신청자 선택</h4>
                                {% csrf_token %}
                                <select id="member_id_dropdown" name="member_id">
                                    <option disabled selected value>위드 단원: 이름을 선택해주세요</option>
                                    <option disabled>────────────</option>
                                    {% for member in members %}
                                        <option value={{ member.id }}>{{ member.name }} {{ member.baptismal_name }}</option>
                                    {% endfor %}
                                </select>
                                <select id="guest_id_dropdown" name="guest_id" style="display:none;">
                                    <option disabled selected value>게스트: 이름을 선택해주세요</option>
                                    <option disabled>────────────</option>
                                    <option value="new">*** 목록에 이름이 없어요! (신규 봉사자 등록)</option>
                                    {% for guest in guests %}
                                        {% if guest.recommender != None %}
                                            <option value={{ guest.id }}>{{ guest.name }} {{ guest.baptismal_name }} (invited by {{ guest.recommender.name }} {{ guest.recommender.baptismal_name }})</option>
                                        {% else %}
                                            <option value={{ guest.id }}>{{ guest.name }} {{ guest.baptismal_name }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                                <div id="new_member" style="display:none;">
                                    <hr class="tmargin25" />
                                    <h4 class="tmargin5 bold">* 신규 봉사자 등록</h4>
                                    <p>처음 1회만 등록하시면 이후부터는 게스트 목록에서 이름을 선택하실 수 있습니다 :)</p>
                                    <input type="text" id="new_name" name="new_name"
                                           placeholder="* 이름"
                                           class="bmargin5 width100">
                                    <input type="text" id="new_baptismal_name" name="new_baptismal_name"
                                           placeholder="* 세례명"
                                           class="bmargin5 width100">
                                    <input type="tel" id="new_contact" name="new_contact"
                                           class="bmargin5 width100"
                                           pattern="[0-9]{3}-[0-9]{4}-[0-9]{4}"
                                           placeholder="* 연락처(하이픈 없이 숫자만 기입)">
                                    <select id="gender_dropdown" name="gender_dropdown" class="bmargin5">
                                        <option disabled selected value>* 성별을 알려주세요!</option>
                                        <option disabled>────────────</option>
                                        <option value=0>자매님</option>
                                        <option value=1>형제님</option>
                                    </select>
                                    <select id="recommender_dropdown" name="recommender_dropdown">
                                        <option disabled selected value>* 누구 소개로 봉사를 신청하시는지 알려주세요!</option>
                                        <option disabled>────────────</option>
                                        <option value='dont_know'>*** 잘 모르겠어요 ㅜ.ㅜ</option>
                                        {% for member in all_members %}
                                            <option value={{ member.id }}>{{ member.name }} {{ member.baptismal_name }}</option>
                                        {% endfor %}
                                    </select>
                                    <hr class="tmargin25" />
                                </div>
                                {% for app_event in app_events %}
                                <h4 class="tmargin25">{{ app_event.a.title }} {{ app_event.title }} ({{ app_event.s_date|date:"m/d" }})</h4>
                                    <select id="application_id_dropdown-{{app_event.id}}" name="app_id-{{app_event.id}}">
                                    {% for app_choice in app_choices %}
                                        <option value={{ app_choice.value }}>{{ app_choice.name }}</option>
                                    {% endfor %}
                                    </select>
                                {% endfor %}
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="modal_footer">
                    <button class="btn btn-b" type="button" onclick="validate()">제출</button>
                </div>
            </div>
        </div>
    </div>
    <!-- end: 봉사신청 modal -->


    <!-- 카톡 알림신청 -->
    <section class="parallax background-overlay-dark p-t-200 p-b-200"
             style="background-image:url(homepages/corporate-v7/images/parallax/4.jpg);">
        <div class="container xs-text-center sm-text-center text-light">
            <div class="row">
                <div class="col-lg-5">
                    <div class="heading-text heading-section">
                        <h2>카카오톡 알림 신청<img src="{% static 'icon/me_appicon_en.png' %}" /></h2>
                        <p class="lead">
                            신청하신 일정의 D-1 리마인드, 자신의 월간 봉사 신청 현황 등을 카카오톡으로 받아보실 수 있어요!
                        </p>
                        <p>
                            최초 1회 인증이 필요합니다. 자세히 알아보시려면 아래 버튼을 눌러주세요.
                        </p>
                    </div>
                    <a href="#services" class="btn btn-light btn-outline btn-rounded">카톡 인증하러 가기</a>
                </div>


                <div class="col-lg-7">
<div class="row">
                    <div class="col-lg-6">
                        <div class="text-center">
                            <div class="counter text-lg"> <span data-speed="3000" data-refresh-interval="50" data-to="12416" data-from="600" data-seperator="true"></span> </div>
                            <div class="seperator seperator-small"></div>
                            <p>LINES OF CODE</p>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="text-center">
                            <div class="counter text-lg"> <span data-speed="4500" data-refresh-interval="23" data-to="365" data-from="100" data-seperator="true"></span> </div>
                            <div class="seperator seperator-small"></div>
                            <p>CUPS OF COFFEE</p>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="text-center">
                            <div class="counter text-lg"> <span data-speed="3000" data-refresh-interval="12" data-to="114" data-from="50" data-seperator="true"></span> </div>
                            <div class="seperator seperator-small"></div>
                            <p>FINISHED PROJECTS</p>
                        </div>
                    </div>
                    <div class="col-lg-6">

                        <div class="text-center">
                            <div class="counter text-lg"> <span data-speed="4550" data-refresh-interval="50" data-to="14825" data-from="48" data-seperator="true"></span> </div>
                            <div class="seperator seperator-small"></div>
                            <p>SATISFIED CLIENTS</p>
                        </div>
                    </div>
                </div></div>
            </div>
        </div>
    </section>
     <!-- end: 카톡 알림신청 -->


    <!-- 봉사신청 현황 -->
    <section id="events" class="p-t-50 p-b-120" style="border-top: 1px #e9e9e9 solid;">
        <div class="container" style="padding: 0 !important;">
            <div class="row">
                <div class="col-lg-12 center" style="text-align: center;">
                    <h2>위드 캘린더</h2>
                    <p>* 각 일정을 누르시면 설명과 참석 신청자 명단을 보실 수 있습니다!</p>
                    <div class="container">
                       <div id="calendar"></div>
                    </div>

                </div>
            </div>
        </div>
    </section>
    <!-- end: 봉사신청 현황 -->


    <!-- 가이드라인 다운로드 링크 -->
    <section class="no-padding equalize" data-equalize-item=".text-box">
        <div class="row col-no-margin">
            <!--Box 1-->
            <div class="col-lg-3" style="background-color: #2F2F2F;">
                <div class="text-box">
                    <i class="fas fa-utensils"></i>
                    <h3>새벽 배식봉사<br />(새봉)</h3>
                    <p>매주 토요일 오전 6시, 서교동성당 지하 1층 하상관에서 시작합니다.
                        70~80명의 노숙인 분들께 아침식사를 제공하는 봉사입니다.</p>
                    <a href="https://drive.google.com/file/d/1d6WOauWKksrWSRoqMj1elCz6_Zrqm5di/view?usp=sharing"
                       target="_blank">
                        <button type="button" class="btn btn-lg btn-warning btn-rounded">
                            가이드라인 다운로드
                        </button>
                    </a>
                </div>
            </div>
            <!--End: Box 1-->
            <!--Box 2-->
            <div class="col-lg-3" style="background-color: #383838;">
                <div class="text-box">
                    <i class="far fa-comments"></i>
                    <h3>은혜로운 집 봉사<br />(은봉)</h3>
                    <p>매월 둘째주 토요일 오전 10시 반, 합정역에서 만나 출발합니다.
                        지적 장애우 분들과 함께 책읽기, 글씨쓰기 등의 활동을 하며 사회와의 연결을 유지하도록 돕는 봉사입니다.</p>
                    <a href="https://drive.google.com/open?id=1AtpVALqobFevYvDzjcm64KHHVvMaZt1u"
                       target="_blank">
                        <button type="button" class="btn btn-lg btn-warning btn-rounded">
                            가이드라인 다운로드
                        </button>
                    </a>
                </div>
            </div>
            <!--End: Box 2-->
            <!--Box 3-->
            <div class="col-lg-3" style="background-color: #313131;">
                <div class="text-box">
                    <i class="fas fa-book"></i>
                    <h3>나눔의 집 봉사<br />(나봉)</h3>
                    <p>매월 1, 3주 일요일 오전 10시 합정역에서 만나 출발합니다.
                       청소년들과 1:1 멘토링을 진행하며 학습을 돕거나 고민 상담 등을 하는 봉사입니다.</p>
                    <a href="https://drive.google.com/open?id=1VzCqQ83nM65qtwEfhPhxIMDPtODdeHpW"
                       target="_blank">
                        <button type="button" class="btn btn-lg btn-warning btn-rounded">
                            가이드라인 다운로드
                        </button>
                    </a>
                </div>
            </div>
            <!--End: Box 3-->
            <!--Box 4-->
            <div class="col-lg-3" style="background-color: #383838;">
                <div class="text-box">
                    <i class="fas fa-clipboard-check"></i>
                    <h3>위드 입단신청서</h3>
                    <p>위드는 언제나 열려있어요. 함께 봉사를 하고 싶은 분들은 부담갖지 마시고 입단 신청 또는 게스트로 신청해주세요!</p>
                    <a href="https://forms.gle/UQFphzvJvEQPLzAR8" target="_blank">
                        <button type="button" class="btn btn-lg btn-warning btn-rounded">
                            입단신청서 바로가기
                        </button>
                    </a>
                </div>
            </div>
            <!--End: Box 4-->
        </div>
    </section>
    <!-- end: 가이드라인 다운로드 링크 -->


    <!-- 생축일 modal -->
    <div class="modal fade" id="special_day" tabindex="-1" role="modal" aria-labelledby="modal-label-2"
        aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="special_day_title" class="modal-title"></h4>
                    <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                </div>
                <div class="modal-body" style="padding: 30px;">
                    <div class="row">
                        <div class="col-md-12">
                            <p id="special_day_desc"></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="float-left">
                        <button data-dismiss="modal" class="btn btn-b" type="button">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end: 생축일 modal -->

    <!-- 이벤트 보기 modal -->
    <div class="modal fade" id="event" tabindex="-1" role="modal" aria-labelledby="modal-label"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="event_title" class="modal-title"></h4>
                    <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                </div>
                <div class="modal-body" style="padding: 0 40px;">
                    <div class="row">
                        <div class="col-md-12">
                            <ul>
                                <li>시작 시간: <span id="start_time"></span></li>
                                <li>종료 시간: <span id="end_time"></span></li>
                                <li>장소: <span id="event_location"></span></li>
                                <li>설명: <span id="event_desc"></span></li>
                                <li>참석: <span id="event_yes_cnt" class="bold"></span>
                                    <ul id="event_yes">
                                    </ul>
                                </li>
                                <li>일찍가야함: <span id="event_early_leave_cnt" class="bold"></span>
                                    <ul id="event_early_leave">
                                    </ul>
                                </li>
                                <li>늦참: <span id="event_late_cnt" class="bold"></span>
                                    <ul id="event_late">
                                    </ul>
                                </li>
                                <li>미정: <span id="event_dont_know_cnt" class="bold"></span>
                                    <ul id="event_dont_know">
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="float-left">
                        <button data-dismiss="modal" class="btn btn-b" type="button">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end: 이벤트 보기 modal -->


    <script>
        // 위드 단원인지 게스트인지 여부에 따라 드랍다운 메뉴가 달라지도록 함
        $('#category_dropdown').on('change', function() {
          if(this.value === "with") {
            $('#member_id_dropdown').show();
            $('#guest_id_dropdown').hide();
            $('#new_member').hide();
          } else {
            $('#member_id_dropdown').hide();
            $('#guest_id_dropdown').show();
          }
        });

        // 신규 봉사자인 경우 신규 등록 폼이 함께 뜨도록 함
        $('#guest_id_dropdown').on('change', function() {
          if(this.value === "new") {
            $('#new_member').show();
          } else {
            $('#new_member').hide();
          }
        });

        // 중복 제출을 막기 위한 jQuery plugin
        jQuery.fn.preventDoubleSubmission = function() {
          $(this).on('submit',function(e){
            var $form = $(this);

            if ($form.data('submitted') === true) {
              // Previously submitted - don't submit again
              e.preventDefault();
            } else {
              // Mark it so that the next submit can be ignored
              $form.data('submitted', true);
            }
          });
          // Keep chainability
          return this;
        };

        // final check popup before submit
        function validate(form) {
            var volunteer_category = $("#category_dropdown").val();
            var member_id = $("#member_id_dropdown").val();
            var guest_id = $("#guest_id_dropdown").val();
            if ( (volunteer_category === 'with' && member_id === null) ||  // 봉사자 이름을 선택하지 않은 경우
                (volunteer_category === 'guest' && guest_id === null) ) {
                alert('앗, 봉사 신청자의 이름이 선택되지 않았어요!');
                return false;
            } else if (volunteer_category === 'guest' && guest_id === 'new') {  // 신규 봉사자
                var new_name = $("#new_name").val();
                var new_baptismal_name = $("#new_baptismal_name").val();
                var new_contact = $("#new_contact").val();
                var new_gender = $("#gender_dropdown").val();
                var recommender = $("#recommender_dropdown").val();
                if (new_name === '') {
                    alert('앗, 신규 봉사자님 이름을 알려주세요!');
                    return false;
                } else if (new_baptismal_name === '') {
                    alert('앗 신규 봉사자 <' + new_name + '>님, 세례명도 알려주세요!');
                    return false;
                } else if (new_contact === '') {
                    alert('앗 신규 봉사자 <' + new_name + ' ' + new_baptismal_name + '>님, 연락처를 알려주세요!\n하이픈 없이 숫자만 기입해주세요!');
                    return false;
                } else if (new_gender === null) {
                    alert('앗 신규 봉사자 <' + new_name + ' ' + new_baptismal_name + '>님, 형제님인지 자매님인지를 알려주세요!');
                    return false;
                } else if (recommender == null) {
                    alert('앗, 위드를 소개해 준 추천인 이름이 선택되지 않았어요!\n추천인을 잘 모르겠으면 "잘 모르겠어요"를 선택해주세요!');
                    return false;
                }
            }
            // 제출 직전 팝업 메시지 창
            var check_message = "아래와 같은 내용으로 제출하시겠어요?\n이름과 신청 내용을 다시 한번 확인해주세요 :)\n미정으로 선택하시면 추후 참&불참 확인 연락 드립니다!\n\n";
            var my_name = "";
            if (volunteer_category === 'with') {
                my_name = $("#member_id_dropdown option:selected").text();  // 위드 단원
            } else if (volunteer_category === 'guest') {
                if (guest_id !== 'new') {
                    my_name = $("#guest_id_dropdown option:selected").text(); // 게스트 기존
                } else {
                    my_name = $("#new_name").val() + ' ' + $("#new_baptismal_name").val();  // 게스트 신규
                }
            }
            check_message += "* 봉사자 이름: <" + my_name + ">\n";
            if (volunteer_category === 'guest' && guest_id === 'new') {  // 신규 봉사자
                check_message += "* 연락처: " + new_contact + "\n";
                check_message += "* 추천인: " + $("#recommender_dropdown option:selected").text() + "\n\n";
            } else {
                check_message += "\n"
            }
            {% for app_event in app_events %}
                check_message += "- [{{ app_event.a.title }}] {{ app_event.title }} ({{ app_event.s_date|date:"m/d" }}): "
                check_message += $("#application_id_dropdown-{{app_event.id}} option:selected").text() + '\n';
            {% endfor %}
            if ( confirm(check_message) === false ) {
               return false;   // cancel
            } else {
               applySubmit();  // form submit
            }
        }
    </script>

{% endblock %}
